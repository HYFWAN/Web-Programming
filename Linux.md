# Linux

## Linux基础

* linux自己的文件数据：/usr/share/doc

* 强调：各个组件或设备在linux下都是一个文件
* 几乎所有的硬件设备都在/dev文件中
* 虚拟机：
  * window下虚拟化软件：VirtualBox ；
  * linux下虚拟化软件：KVM
* x-window与命令行模式的切换：ctrl + alt + [F1-F6]  (笔记本需要加Fn)， 默认F1为图形用户界面。
* 在终端登陆和退出：快捷键切换图形用户和终端，按exit推出终端（注销）
* ctrl+c  中断当前程序 ；   ctrl+d  离开终端（相当于exit）

## 文件属性

* ls   -l/-a/-h   ：显示文件名与相关信息
* -a 显示所有文件  -l显示详细信息 -h以人性化方式现实
* 第一栏表示文件的类型与权限：
  * 第一个字符表示文件类型
  * [d]表示目录
  * [-]表示文件
  * [l]表示链接文件(link file)
  * [b]表示设备文件中可供存储的设备
  * [c]表示设备文件中的串行端口设备
  * 接下来字符[rwx]三个一组表示权限[r]表示可读，[w]表示可写，[x]表示可执行
  * 第一组为文件拥有者权限，第二组为用户组权限，第三组为非本人且没有加入本用户组的其他账号权限
  * 无论文件权限为什么，默认root都可以进行读写
* 第二栏表示有多少文件名链接到此节点
* 第三栏表示该文件或目录的拥有者
* 第四栏表示该文件或目录所属的用户组
* 第五栏表示文件的容量大小，默问题问题认单位为Bytes
* 第六栏为该文件的创建日期或最后一次修改日期
* 第七栏为文件名：文件名之前多了一个 . 表示文件为隐藏文件
* cp   -f/-i/-r   ：拷贝操作
  * -f 已存在直接覆盖  -i覆盖前提醒 -r复制目录文件递归复制
  * cp ~/Desktop/11.txt 22.txt

## 修改文件属性与权限

* chown   用户名   文件/目录       ：修改拥有者
* charp  (-R)  组名  文件/目录       ：修改组
* chmod  (-R)  755  文件/目录      ：修改权限
  * r----4    w----2    x----1    
  * rwx(7)  rw-(6)  r-x(5)  -wx(4)  -wx(3)  -w-(2)  --x(1)
* chmod  +/-(rwx)  文件/目录       ：修改权限
* 权限对于文件：
  * r：可读取文件的内容
  * w：可以编辑，新增，修改文件内容（不能删除该文件）
  * x：可以被执行
* 权限对于目录：
  * r：可读取目录下的文件（读取目录结构）
  * w：改动目录结构的权限
    * 建立新文件和目录
    * 删除文件和目录
    * 重命名文件
    * 移动文件
  * x：用户能否进入该目录

## linux文件种类和扩展名

* 文件种类(regular file）：
  * 常规文件[-] ：
    * 纯文本文件
    * 二进制文件：可执行文件的格式就算二进制文件
    * 数据文件：程序运行时读取的文件
  * 目录（directory) [d]
  * 链接文件(link file) [l] ：类似window下的快捷方式
  * 设备与设备文件(device) [b/c]：与系统周边及存储等相关的一些文件，通常集中于/dev目录下
    * 区块(bloc) [b] 设备文件：一些存储数据，以提供系统随机存取的接口设备，如软盘和硬盘
    * 字符(character) [c] 设备文件：串行端口的接口设备，如键盘，鼠标等
  * 数据接口文件(sockets）：用于网络上的数据交换
  * 数据传送文件(FIFO,pipe) ：解决多程序读写一个文件造成的错误问题
* linux文件扩展名
  * 一个linux文件能否被执行只与文件属性第一栏中的十个属性有关，与文件名（扩展名）无关，带有-x代表该文件具有可被执行的能力
  * 虽然如此，但我们也希望可以借由扩展名来判断文件类型：
    * *.sh：脚本或批处理文件(scripts)，因为批处理使用shell写成，所以扩展名编成.sh
    * *Z , *.tar , *.tar.gz , *.zip , *.tgz ：经打包后的压缩文件，其拓展名与不同的压缩软件有关
    * *.html, *.php ：网页相关文件，分别代表HTML与PHP语法的网页文件

## linux目录配置的依据----FHS

* 目的：规范每个目录应该放置某种特定的数据，让用户可以了解到已安装的软件通常放置于哪个目录下
* FHS依据文件系统使用的频繁与否，是否允许用户随意更改将目录定义为四种交互作用的形态：
  * 不变：不经常变动的数据，数据库，文件说明等；可变动：经常修改的数据，日至文件等。
  * 可分享：可以分享给其他系统挂载使用的目录；不可分享：自己机器上面运行的设备文件或是与程序有关的socket文件，仅与自身机器有关，不适合分享给其他主机。
  * 不变(static) ：
    * 可分享(shareable) ：	
      * /usr (软件存放处)
      * /opt(第三方辅助软件)
    * 不可分享(unshareable) ：
      * /etc(配置文件)
      * /boot(启动与内核文件)
  * 可变动(variable)：
    * 可分享(shareable) ：
      * /var/mail(用户邮箱)
      * /var/spool/news(新闻组)
    * 不可分享(unshareable) ：
      * /var/run(程序相关)
      * /var/lock(程序相关)
* 实际上，FHS针对目录树架构仅定义出三层目录下面应该放置什么数据：
  * /(root,根目录) ：与系统启动相关
  * /usr(unix software resource) ：与软件安装/执行有关
  * /var(variable) ：与系统运行过程有关
* root ：以账号的角度来看，是系统管理员身份；以目录的角度看，指的是根目录，就是 /
* 根目录的意义与内容：
  * 系统中最重要的一个目录，所有的目录都是由根目录衍生而来，也与启动，还原，系统修复等操作相关。
  * FHS建议：根目录所在分区应该越小越好，且应用程序所安装的软件最好不要与根目录在同一个分区，保持根目录越小越好，如此不但性能较佳，且根目录所在的文件系统也较不容易发生问题。
* /usr    (unix software resource)
  * /usr里面放置的数据属于**可分享不可变动**
  * UNIX 操作系统软件资源所放置的目录，而不是存放用户的数据
* /var
  * 在系统运行后才会逐渐占用硬盘空寂那容量的目录，主要针对**经常变动的文件**，包括缓存(cache),日志文件(log file),以及某些软件运行时所产生的文件，包括程序文件(lock file,run file)等
* 由于FHS金定义了最上层（/）及次层（/usr，/var）的目录内容应该要放置的文件或目录数据，因此在其他子目录层级内，就可以随开发者自行配置。
* 目录与路径
  * 根目录(root,/)的上一层(..)与根目录自己(.)是用一个目录
  * mkdir  (-p)    目录名称      （递归）创建一个目录
  * rmdir   (-p)    目录名称     （递归）删除一个空目录
* 执行文件目录的变量  $PATH
  * echo $PATH   可以显示出当前的环境变量
* 直接执行ll (L的小写) 相当于执行  ls -l

## 复制，删除，移动

* 复制 (cp)
  * -a   复制文件的所有特性；
  * -i     覆盖时询问
  * -p    将文件属性（权限，用户，时间）一起复制过去，而非使用默认属性
  * -r     递归复制
  * -l      进行硬链接(hard link)的链接文件建立，并非复制文件本身
  * -s      复制成为符号链接(symbolic link)文件，即快捷方式
  * 在默认的条件中，cp的源文件与目标文件的权限不同，目标文件的拥有者通常会是命令操作者本身
  * 因此在备份时，某些需要特别注意的权限文件，如密码文件等，就不能以cp直接复制，而必须加上-a或-p等复制文件权限的选项才行；另外，如果想要复制文件给其他用户，也必须注意文件的权限（包含读写执行及文件拥有者等），否则其他人无法针对文件进行自定义操作
* 删除(rm)
  * -f       强制删除
  * -i       删除前询问
  * -r      递归删除目录
* 移动(mv)
  * -f      强制覆盖
  * -i       覆盖前询问
  * -u      仅当source较新时才覆盖

## 文件内容的查看

* cat(concatenate)
  * -b      显示非空行行号
  * -n      显示所有行行号
* tac  反向显示内容
* nl  （添加行号显示）
  * 相当于 cat -b ，即仅显示非空行
* -b      指定行号
  * -b a    无论是否为空行，同样列出行号
  * -b  t    不列出空行的行号（默认）
* -n      列出行号表示的方法
  * -n ln    行号在屏幕最左方显示
  * -n rn    行号在最右方显示，不加0
  * -n rz     行号在最右方显示，加0
* -w     行号栏位占用的字节数  
  * eg：nl  -n rz -w 3 11.txt
* more  翻页查看  
  * 空格(space) ：向下翻页
  * Enter ：向下翻一行
  * /字符串：在这个显示内容当中，向下查找字符串这个关键词,按n显示下一个
  * :f ：立即显示出文件名以及目前显示的行数
  * q ：离开more
  * b或ctrl+b ：往回翻页
* less  一页一页翻动
  * 空格 ：向下翻动
  * [pagedown] ：向下翻动
  * [pageup] ：向上翻动
  * /字符串 ：向下寻找
  * ？字符串 ：向上寻找
  * n ：重复前一个寻找
  * q ：离开less

## 数据截取

* head  取出前面几行
  * -n  [num] ：显示前num行，如果num为负数，则显示除后num行以外的所有行
  * 默认显示前十行
* tail   取出后面几行
  * -r   [num] ：显示后num行；若num带正号，则表示显示从num行之后的内容，如 tail -r +10 表示显示第10 行之后的内容（第10行不显示）
  * -f ： 表示持续刷新后面所接文件内容（文件被持续写入时），等到按下ctrl+c结束
* 显示11-20行的信息，同时显示行号：利用管道
  * cat -n 11.txt | head -n 20 | tail 10
* 非文本文件读取：od

  * od  [-t TYPE]  ： 后面接各种类型文件输出
  * a          利用默认字符输出
  * c          利用ASCII字符输出
  * d [size]      利用十进制（decimal）来输出数据，每个整数占siie Bytes
  * f  [size]       利用浮点数值（floating）来输出数据，每个数占用size Bytes
  * o[size]        利用八进制（octal）来输出数据，每个整数占用size Bytes
  * x[size]         利用十六进制（hexadecimal）来输出数据，每个整数占用size Bytes

## 创建文件

* touch    创建新文件/修改文件时间
* 每个linux文件下都会记录许多时间参数	
  * 修改时间 (modification time , mtime)
    * 当文件内容数据变更时，就会更新该时间
  * 状态时间 (status time , ctime)
    * 文件状态发生改变时，更新该时间，如权限和属性改变时
  * 读取时间 (access time , atime)
    * 当文件内容被读取时，更新该时间，如用cat读取
  * 默认ls显示该文件的mtime
* touch   [-acdmt]   文件名
  * -a        仅自定义 access time
  * -c        仅修改文件时间，文件不存在不新建文件
  * -d        后面可以接欲自定义的时间日期，也可以使用--date=“日期或时间”
  * -m       仅修改 modification time
  * -t         后面可以接欲自定义的时间，格式为 [YYYYMMDDhhmm]

## 文件默认权限 ：umask

* umask是指定当前用户在建立文件或目录的时候的权限默认值

  * 直接执行umask，得到四个数字，与一般权限有关的时后三个数字
  * 加入-S（Symbolic）这个选项，就会以符号的形式来显示出权限

  ```
  #：umask
  
  0022  //与一般文件有关的时后面三个数字
  
  #：umask -S
  
  u=rwx,  g=rx,  o=rx  //以符号的形式来显示出权限，u->user , g->group , o->others
  ```

* 用户建立的文件默认没有x权限，即只有rw权限，最大为666，默认权限为 -rwxrw-rw-

* 用户建立的目录，则由于x与是否能进入目录有关，因此默认为所有权限均开放，默认权限为 drwxrwxrwx

* 注意：umask的数字指的是默认值需要减掉的数值

  当umask为022时

  建立文件时，(--rw-rw-rw)-(-----w--w )=(-rw-r--r-)

  建立目录时，(drwxrwxrwx)-(d----w--w-)=(drwxr-xr-x)

## 文件隐藏属性

* chattr  配置文件隐藏属性

  * chattr [+-=] [ASacdistu]
  * +/-/=    增加/删除/直接设置 参数
  * a     当设置a之后，这个文件只能增加数据，不能删除或修改数据，只有root能设置这个属性
  * i      当设置i之后，可以让一个文件不能被删除/改名/设置链接，也无法写入/新增数据，对系统安全性有很大的帮助，只有root能设置这个属性

* lsattr  显示文件隐藏属性

  * lsattr  [-adR]  文件/目录
  * -a      将隐藏文件(.file)的属性也显示出来
  * -d      如果接的是目录，仅列出目录本身的属性而非目录内的文件名
  * -R      连同子目录的数据也一并列出来

* 文件特殊权限：SUID  、 SGID 、SBIT

  * SUID （Set UID）
    * 当s权限出现在文件拥有者x权限上时，此时被称为Set UID（简称SUID）的特殊权限
    * SUID的权限和功能：
      * SUID仅对二进制文件有效，对目录无效
      * 执行者对于该程序需要具有x的可执行权限
      * 本权限仅在执行该程序的过程中有效（run-time）
      * 执行者将具有该程序拥有者（owner）的权限
    * 例如，只有root有修改passwd的权限，但某个账号可以修改自己账号的密码，因为该账号在执行passwd的过程中，会暂时拥有root的权限，这就是SUID的功能
  * ​    SGID    (Set GID)
    * 当s权限出现在用户组x权限上时，被称为Set GID （简称SGID）
    * 对文件来说，SGID功能：
      * SGID对二进制文件有用
      * 程序执行者对于该程序来说，需具备x的权限
      * 执行者在执行的过程中将会获得该程序用户组的支持
    * 对目录来说，SGID功能：
      * 用户若对此目录具有r或x的权限时，该用户能够进入此目录
      * 用户在此目录下的有效用户组将会变成该目录的用户组
      * 用途：若用户在此目录下具有w的权限，则用户所建立的新文件的用户组与此目录的用户组相同
  * SBIT (Sticky Bit)
    * Sticky Bit 只针对目录有效，对目录的作用是：
      * 但用户对此目录具有w、x权限，即具有写入的权限
      * 当用户在该目录下建立文件或目录时，仅有自己与root才有权力删除该文件
  * SUID/SGID/SBIT 权限设置
    * SUID--4；SGID--2；SBIT--1
    * eg:    chomd  4755  文件名  ->  [-rws-wx-wx]

## 命令与文件的查找

* 脚本文件的查找

  * which   查找执行文件
    * which  [-a]  command
    * -a   将所有由PATH目录中可以找到的命令均列出
    * 这个命令就是根据[PATH]这个环境变量所规范的路径，去查找执行文件的文件名

* 文件的查找

  * whereis   由一些特定的目录中查找文件
    * whereis  [-bmsu]  文件或目录名
    * -l   列出whereis会列出的几个主要目录
    * -b  只找binary二进制文件
    * -m  只在说明文件manual路径下的文件
    * -s     只找source源文件
    * -u     查找不再上述三个项目当中的其他特殊文件
    * whereis只在几个特定目录（主要针对usr/sbin,usr/share/man)中查找，所以查找速度比较快
  * locate/updatedb
    * locate  [ir]  keyword
    * -i       忽略大小写
    * -c      不输出文件名，仅计算查找到的文件数量
    * -l  num      仅输出num行，输出查找到的前num行
    * -S        输出locate所使用的数据库文件的相关信息，包括该数据库记录的文件/目录数量
    * -r         后面接正则表达式的显示 方法
    * locate查找时，当在完整文件名（包括路径名称）中，只要有keyword在其中，就会被显示出来，这在忘记完整文件名时特别好用
    * locate寻找的数据是由已建立的数据库/var/lib/mlocate里面的数据查找到的，不用到硬盘中直接读取数据
    * 当建立新文件时，需要更新数据库才能找到该文件
    * 更新数据库的方法---updatedb
    * updatedb ：根据etc/updatedb.conf的设置去查找系统硬盘内的文件，并更新/var/lib/mlocate内的数据库文件
    * locate ：依据/var/lib/mlocate内的数据库记录，找出用户所输入关键词的文件名
  * find
    * find [PATH]  [option]  [action]
    * 与时间有关的选项：
      * -mtime  n     n为数字，意义为在n天前的那一天被修改过内容的文件
      * -mtime  +n      列出在n天之前（不含n天本身）被修改过内容的文件
      * -mtime  -n       列出在n天之内（含n天本身）被修改过内容的文件
      * -newer  file      file为一个存在的文件，列出比file还要新的文件
      * find  /  -mtime  0     显示/中24小时内被修改过的文件；find  /etc  -newer  /etc/passwd      显示比/etc/passwd新的文件
    * 与使用者或用户组名称有关的参数
      * -uid  n     n为数字，该数字是使用者的账号ID，即UID（记录在/etc/passwd中）
      * -gid  n     n为数字，该数字为用户组名称的ID，即GID（记录在/etc/group中）
      * -usr  name      name为使用者账号名称
      * -group  name      name为用户组名称
      * -nouser      查找文件的拥有者不再/etc/passwd中
      * -nogroup      查找文件的拥有者不再/etc/group中
      * 当安装软件时，很可能该软件的属性中没有文件拥有着，这时候就可以使用-nouser与nogroup查找
    * 与文件权限及名称有关的参数

      















